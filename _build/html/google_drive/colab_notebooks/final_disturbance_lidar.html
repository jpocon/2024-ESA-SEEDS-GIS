

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mapping Fire Impacts - LiDAR-based &#8212; 2024 ESA SEEDS GIS Workshop</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'google_drive/colab_notebooks/final_disturbance_lidar';</script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Zonal Stats: Exploring spectra by land cover" href="final_landcover_zonalstats.html" />
    <link rel="prev" title="Mapping Fire Impacts - Raster-based" href="final_disturbance_raster.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../about.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/update_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/update_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../about.html">
                    Welcome to the 2024 ESA SEEDS GIS Workshop!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Set Up</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="google_tools.html">Getting Started with Google Tools for GIS and Ecological Applications</a></li>



<li class="toctree-l1"><a class="reference internal" href="mount_drive.html"><strong>Mounting Google Drive</strong></a></li>



<li class="toctree-l1"><a class="reference internal" href="update_url_download.html">Download data directly from URL</a></li>
<li class="toctree-l1"><a class="reference internal" href="geemap_python_api.html"><strong><code class="docutils literal notranslate"><span class="pre">geemap</span></code> Setup in Colab</strong></a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">GIS &amp; Remote Sensing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="update_background.html">Getting Started with GIS &amp; Remote Sensing</a></li>


<li class="toctree-l1"><a class="reference internal" href="update_neon_aop.html"><strong>Introduction to NEON AOP</strong></a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Group Exercises</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="final_pca_kmeans.html"><strong>Principal Component Analysis &amp; Kmeans Clustering</strong></a></li>

<li class="toctree-l1"><a class="reference internal" href="final_disturbance_raster.html"><strong>Mapping Fire Impacts - Raster-based</strong></a></li>



















































































































































































<li class="toctree-l1 current active"><a class="current reference internal" href="#">Mapping Fire Impacts - LiDAR-based</a></li>

<li class="toctree-l1"><a class="reference internal" href="final_landcover_zonalstats.html"><strong>Zonal Stats: Exploring spectra by land cover</strong></a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/jpocon/2024-ESA-SEEDS-GIS/blob/master/google_drive/colab_notebooks/final_disturbance_lidar.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/jpocon/2024-ESA-SEEDS-GIS" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/google_drive/colab_notebooks/final_disturbance_lidar.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Mapping Fire Impacts - LiDAR-based</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Mapping Fire Impacts - LiDAR-based</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reflection-exercises-for-each-group">Reflection exercises for each group:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">Import Packages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-tip">Data Tip</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lidar-metadata">Lidar Metadata</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lidar-documentation-qa-pdfs">Lidar Documentation - QA pdfs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-plot-shapefile-boundaries">Download and Plot Shapefile Boundaries</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-point-cloud-data-with-laspy">Exploring point cloud data with <code class="docutils literal notranslate"><span class="pre">laspy</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#d-point-cloud-visualization">3D Point Cloud Visualization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lidar-raster-data-dtm-dsm-and-chm">Lidar Raster Data - DTM, DSM, and CHM</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#lidar-raster-data-group-notes">Lidar Raster Data (group notes)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-and-compare-the-relative-height-percentiles-of-the-discrete-returns-before-2019-and-after-2021-the-2020-creek-fire">Calculate and compare the relative height percentiles of the discrete returns before (2019) and after (2021) the 2020 Creek fire.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discrete-return-heights-relative-to-2021-dtm">1. Discrete-return heights relative to 2021 DTM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-10m-spatial-resolution-raster-grid-and-assign-a-unique-id-to-each-10m-pixel">2. Create a 10m spatial resolution raster grid and assign a unique id to each 10m pixel</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#group-all-discrete-returns-based-on-the-10m-pixel-they-fall-into">3. Group all discrete returns based on the 10m pixel they fall into.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-height-percentiles-of-discrete-returns-20th-30th-50th-75th-and-90th-for-each-10m-pixel">4. Calculate height percentiles of discrete returns (20th, 30th, 50th, 75th, and 90th) for each 10m pixel.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-the-distribution-of-height-percentiles-for-the-years-2019-and-2021">5. Compare the distribution of height percentiles for the years 2019 and 2021.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">Additional Resources</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-and-beyond-other-options-for-working-with-point-cloud-data">Python and Beyond - Other Options for working with Point Cloud Data</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="section" id="mapping-fire-impacts-lidar-based">
<h1>Mapping Fire Impacts - LiDAR-based<a class="headerlink" href="#mapping-fire-impacts-lidar-based" title="Permalink to this heading">#</a></h1>
<div class="section" id="reflection-exercises-for-each-group">
<h2>Reflection exercises for each group:<a class="headerlink" href="#reflection-exercises-for-each-group" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>At the top of the Colab notebook that you share with everyone, please include your responses to the following questions:</p></li>
</ol>
<ul class="simple">
<li><p>Choose at least 1 dataset to explore in more detail.</p></li>
<li><p>What is the projection for this dataset?</p></li>
<li><p>Where can you find more information on how the data were collected and how to interpret the metadata?</p></li>
<li><p>Think about what data type each variable is.</p></li>
<li><p>Is it vector or raster data? What properties exist for each dataset?</p></li>
<li><p>What resolution are your data?</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>At the top of the Colab notebook, write a short summary detailing the processing steps in the notebook and your results.</p></li>
</ol>
<ul class="simple">
<li><p>Although these topics may be far removed from your own interests, how could these steps and analyses help in your own work?</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>OPTIONAL - Expand your script by adding additional processing, analysis, or other data.</p></li>
</ol>
<p>As you’re working through your exercise, <strong>add code chunks to further document your scripts. Add additional comments to the code itself to clarify complicated processes.</strong></p>
</div>
<hr class="docutils" />
<div class="section" id="objectives">
<h2>Objectives<a class="headerlink" href="#objectives" title="Permalink to this heading">#</a></h2>
<p>After completing this exercise, you will be able to:</p>
<ul class="simple">
<li><p>Use Python functions to programmatically download NEON AOP data from the API</p></li>
<li><p>Download and plot shapefiles and kmls (included as lidar metadata) to visualize coverage for a given year</p></li>
<li><p>Explore and plot the AOP discrete lidar point cloud contents in Python using the <code class="docutils literal notranslate"><span class="pre">laspy</span></code> package</p></li>
<li><p>Read in and plot the AOP L3 raster data products (CHM, DTM, DSM) in Python using the <code class="docutils literal notranslate"><span class="pre">rasterio</span></code> package</p></li>
</ul>
<p>Acknowledgement:</p>
<blockquote>
<div><p>The National Ecological Observatory Network is a program sponsored by the National Science Foundation and operated under cooperative agreement by Battelle. This material is based in part upon work supported by the National Science Foundation through the NEON Program.”</p>
</div></blockquote>
<p>This notebook was adapted from <a class="reference external" href="https://github.com/NEONScience/NEON-Data-Skills/blob/main/tutorials/Python/AOP/Lidar/lidar-applications/lidar-wildfire/fire-effects-veg-structure-lidar.md">Detecting changes in vegetation structure following fires using discrete-return LiDAR</a>, as well as the <a class="reference external" href="https://github.com/NEONScience/NEON-Data-Skills/blob/main/tutorials/Python/AOP/Lidar/intro-lidar/intro_point_clouds_py/intro_discrete_point_clouds.md">Introduction to NEON Discrete Lidar Data in Python</a>. The <a class="reference external" href="https://www.neonscience.org/resources/learning-hub">NEON learning hub</a> is a great resource to learn more!</p>
<div id="ds-objectives" markdown="1">
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<p>The <strong>Creek Fire</strong> was a large wildfire that started in September 2020 in the Sierra National Forest, California and became one of the largest fires of the <a class="reference external" href="https://en.wikipedia.org/wiki/2020_California_wildfires">2020 California wildfire season</a>. This fire had burned into NEON’s <a class="reference external" href="https://www.neonscience.org/field-sites/soap">Soaproot Saddle (SOAP)</a> site by mid-September, causing a <a class="reference external" href="https://www.neonscience.org/impact/observatory-blog/domain-digest-no-4-fire-field-sites-and-recovery">high intensity burn over much of the site</a> - standing trees became charcoal spires, shrubs and their root systems burned completely, the thick litter layer was incinerated, and the soil severely burned.</p>
<p>The NEON Airborne Observation Platform (AOP) conducted aerial surveys over SOAP in 2019 and 2021, a year before and after the Creek Fire. This exercise aims to study the effects of fire on vegetation structure by comparing the lidar-derived relative height percentiles before and after the fire. In addition to the discrete return data, this tutorial uses a Digital Terrain Model (DTM) to determine the relative height of the discrete returns with respect to the ground.</p>
<p>This Python tutorial is broken down into three parts:</p>
<ol class="arabic simple">
<li><p>Read the NEON discrete-return lidar data (<a class="reference external" href="https://data.neonscience.org/data-products/DP1.30003.001">DP1.30003.001</a>) and visualize the 3D lidar point cloud.</p></li>
<li><p>Read the lidar-derived Digital Terrain Model (<a class="reference external" href="https://data.neonscience.org/data-products/DP3.30024.001">DP3.30024.001</a>) in Python. Visualize the spatial extent of the lidar data used in this tutorial with that of the Creek Fire perimeter and the SOAP flight boundary.</p></li>
<li><p>Calculate and compare the relative height percentiles of the discrete returns before and after the 2020 Creek Fire.</p></li>
</ol>
<p>NEON provides both discrete return and full-waveform LiDAR data for its field sites across the US. The discrete return LiDAR point cloud differs from the full waveform data as it is considerably smaller in file size and condenses the information into a small number of points per laser shot rather than many data bins (roughly 100 bins per laser shot in the full waveform data).</p>
<div class="section" id="import-packages">
<h3>Import Packages<a class="headerlink" href="#import-packages" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>rasterio
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>rioxarray
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>laspy<span class="o">[</span>lazrs,laszip<span class="o">]</span>
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pyproj
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>shapely
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>seaborn
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>geopandas
<span class="c1">#an acronym of “pip Install Packages” is today the standard tool for installing Python packages</span>

<span class="c1">#import required packages</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">laspy</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Patch</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>
<span class="kn">import</span> <span class="nn">pyproj</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">Proj</span>
<span class="kn">import</span> <span class="nn">shapely</span>
<span class="kn">from</span> <span class="nn">shapely</span> <span class="kn">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span>  <span class="c1">## Try this if this line throws an error: from shapely.geometry import Polygon, MultiPolygon</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">import</span> <span class="nn">rioxarray</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="c1">#import warnings</span>
<span class="c1">#warnings.filterwarnings(&#39;ignore&#39;)</span>
</pre></div>
</div>
</div>
</div>
<p>If you haven’t saved the neon_aop_download_functions.py script locally, you can do that programmatically as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/NEONScience/NEON-Data-Skills/main/tutorials/Python/AOP/aop_python_modules/neon_aop_download_functions.py&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">open</span><span class="p">(</span><span class="s2">&quot;neon_aop_download_functions.py&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we’ll pull in all the functions in the module <strong>neon_aop_download_functions.py</strong>.</p>
<p>First make sure this script is saved in your working directory, which we can check by navigating into that directory, or by using <code class="docutils literal notranslate"><span class="pre">os.listdir</span></code>. If you haven’t saved it in your working directory, you will need to provide the relative path to this script when importing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># check that script is saved in same folder:</span>
<span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
</pre></div>
</div>
<p>Once you’ve confirmed that the <code class="docutils literal notranslate"><span class="pre">neon_aop_download_functions</span> <span class="pre">script</span></code> is in your working directory, you can import the contents of this file as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">neon_aop_download_functions</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<p>Alternatively, if you’d like to see the contents of that file in your notebook, you can use the “magic” command <code class="docutils literal notranslate"><span class="pre">%load</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load</span> <span class="n">neon_aop_download_functions</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If you go this route, you will need to run the cell twice for the functions to be read into the notebook. The first run will load the functions into the cell, and the second run will load the functions into the working environment. This option of loading in the functions may be useful if you wish to modify the functions locally, eg. according to your specific workflow.</p>
<p>Now that we’ve imported in all the required packages and functions, we can get started! First let’s take a look at what exactly we’ve imported by using the magic command <code class="docutils literal notranslate"><span class="pre">%whos</span></code>. Since there is no variable explorer in Jupyter Notebooks, this is a quick way to see the contents (variables, functions, modules, etc.) that have been loaded in our current environment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">whos</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-tip">
<h3>Data Tip<a class="headerlink" href="#data-tip" title="Permalink to this heading">#</a></h3>
<p>If you are unsure what a function or module does, you can find more information about the function in two ways:</p>
<ol class="arabic simple">
<li><p>type <code class="docutils literal notranslate"><span class="pre">help(function_name)</span></code>, which will print out documentation below the cell, or</p></li>
<li><p>type the function name followed by <code class="docutils literal notranslate"><span class="pre">?</span></code>, which will pop up the documentation at the bottom of your Jupyter Notebook window, and you can then exit out of it at your convenience</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>help(requests)
requests?
</pre></div>
</div>
<p>The functions loaded from the <code class="docutils literal notranslate"><span class="pre">neon_aop_download_functions.py</span></code> file also include similar documentation, so you can also use the help function with for user-defined functions, as long as the appropriate <code class="docutils literal notranslate"><span class="pre">docstrings</span></code> (comments) have been added.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>help(list_available_urls)
list_available_urls?
</pre></div>
</div>
<p>Now that we’ve pulled in the packages needed for the first part of the tutorial, we can download a dataset from the NEON API.</p>
<p>First we’ll start by defining variables that specify the NEON data product ID (<code class="docutils literal notranslate"><span class="pre">dpID</span></code>), site, and year. You can change the site code to look at a different site of your interest (for more detailed information about the NEON sites, please check out the <a href="https://www.neonscience.org/field-sites/explore-field-sites" target="_blank">Explore Field Sites</a> webpage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dpID</span><span class="o">=</span><span class="s1">&#39;DP1.30003.001&#39;</span>
<span class="n">site</span> <span class="o">=</span> <span class="s1">&#39;SOAP&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>We can use the function <code class="docutils literal notranslate"><span class="pre">list_available_urls</span></code> to see what data is available for this data product and site. This function requires two inputs: the data product ID <code class="docutils literal notranslate"><span class="pre">dpID</span></code> and the site ID, <code class="docutils literal notranslate"><span class="pre">site</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">list_available_urls</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_available_urls</span><span class="p">(</span><span class="n">dpID</span><span class="p">,</span><span class="n">site</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The AOP has only flown Puerto Rico (D04) once so far, in 2018. D04 is only on the AOP schedule every 4 years; the next campaign is scheduled for the fall of 2022, so new data is expected relatively soon!</p>
<p>Next let’s set up some paths where we can save our downloaded data. We’ll start with downloading geospatial metadata in order to get a sense of the coverage (geographic extents) of the flight area. We’ll make a folder for the shapefiles (shp), kml files (which may be useful for interactively looking at the site boundaries in Google Earth), and a folder for the actual lidar (laz) data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span><span class="o">=</span><span class="s1">&#39;2021&#39;</span>
<span class="n">year2</span><span class="o">=</span><span class="s1">&#39;2019&#39;</span>
<span class="n">data_root_path</span> <span class="o">=</span> <span class="s1">&#39;./data/&#39;</span><span class="o">+</span><span class="n">site</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
<span class="n">data_root_path2</span> <span class="o">=</span> <span class="s1">&#39;./data/&#39;</span><span class="o">+</span><span class="n">site</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">year2</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
<span class="n">shp_path</span> <span class="o">=</span> <span class="n">data_root_path</span><span class="o">+</span><span class="s1">&#39;shp/&#39;</span>
<span class="n">shp_path2</span> <span class="o">=</span> <span class="n">data_root_path2</span><span class="o">+</span><span class="s1">&#39;shp/&#39;</span>
<span class="n">kml_path</span> <span class="o">=</span> <span class="n">data_root_path</span><span class="o">+</span><span class="s1">&#39;kml/&#39;</span>
<span class="n">kml_path2</span> <span class="o">=</span> <span class="n">data_root_path2</span><span class="o">+</span><span class="s1">&#39;kml/&#39;</span>
<span class="n">laz_path</span> <span class="o">=</span> <span class="n">data_root_path</span><span class="o">+</span><span class="s1">&#39;laz/&#39;</span>
<span class="n">laz_path2</span> <span class="o">=</span> <span class="n">data_root_path2</span><span class="o">+</span><span class="s1">&#39;laz/&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_root_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_root_path2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, let’s take a look at the <code class="docutils literal notranslate"><span class="pre">download_aop_files</span></code> function, which we’ll use to download the metadata and data that we want to explore.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">download_aop_files</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The only required inputs for this function are the <code class="docutils literal notranslate"><span class="pre">product</span></code> and the <code class="docutils literal notranslate"><span class="pre">site</span></code>; optionally we can specify the <code class="docutils literal notranslate"><span class="pre">year</span></code>, the <code class="docutils literal notranslate"><span class="pre">download_folder</span></code> to save the files, and a <code class="docutils literal notranslate"><span class="pre">match_string</span></code> to download a subset of the data by a string. By default, the function will display the size of the files, and prompt the user to continue the download (by typing <code class="docutils literal notranslate"><span class="pre">y</span></code>); any other response will halt the download. This is to prevent an accidental download of a large volume of data.</p>
</div>
</div>
<div class="section" id="lidar-metadata">
<h2>Lidar Metadata<a class="headerlink" href="#lidar-metadata" title="Permalink to this heading">#</a></h2>
<p>We’ll start by downloading the some of the metadata, including the pdf documentation, and shape files that provide geographic information corresponding to the data. Because AOP data can be pretty large for an entire site, and you may only need to work with a subset of the data for a given site, we recommend starting with downloading only the metadata.</p>
<div class="section" id="lidar-documentation-qa-pdfs">
<h3>Lidar Documentation - QA pdfs<a class="headerlink" href="#lidar-documentation-qa-pdfs" title="Permalink to this heading">#</a></h3>
<p>AOP data provides summary pdf documents, which include important information about the sensors used to collect the lidar data, acquisition parameters, processing parameters, and QA information. When working with any AOP data, we recommend reviewing this documentation, as well as referencing the relevant ATBDs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#download the QA reports to the default download directory (./data)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="n">dpID</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="n">dpID</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year2</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Please take a look at these pdfs on your own time!</p>
</div>
<div class="section" id="download-and-plot-shapefile-boundaries">
<h3>Download and Plot Shapefile Boundaries<a class="headerlink" href="#download-and-plot-shapefile-boundaries" title="Permalink to this heading">#</a></h3>
<p>There are summary shape files provided along with the lidar data for each site. These summary files end with <code class="docutils literal notranslate"><span class="pre">merged_tiles.shp/.shx</span></code>, so we can key off that string to download only the full boundary shape file. You could also download all of the individual <code class="docutils literal notranslate"><span class="pre">.shp</span></code> files for each data tile (L3 data is provided in 1km x 1km tiles), by using the match string <code class="docutils literal notranslate"><span class="pre">.shp</span></code>, or similarly all the <code class="docutils literal notranslate"><span class="pre">.kml</span></code> files, if you wanted to pull the data boundaries into Google Earth and explore more interactively.</p>
<p>We’ll download the merged_tiles shapefiles (you need to download both extensions .shp and .shx):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#download the full-boundary shape files</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="n">dpID</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">shp_path</span><span class="p">,</span><span class="s1">&#39;merged_tiles.shp&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="n">dpID</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">shp_path</span><span class="p">,</span><span class="s1">&#39;merged_tiles.shx&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">download_aop_files</span><span class="p">(</span><span class="n">dpID</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year2</span><span class="p">,</span><span class="n">shp_path2</span><span class="p">,</span><span class="s1">&#39;merged_tiles.shp&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="n">dpID</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year2</span><span class="p">,</span><span class="n">shp_path2</span><span class="p">,</span><span class="s1">&#39;merged_tiles.shx&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can see that these files have downloaded to the expected location by listing the contents of the <code class="docutils literal notranslate"><span class="pre">shp_path</span></code> directory that we’ve made:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">shp_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">shp_path2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can see these files in the <code class="docutils literal notranslate"><span class="pre">shp</span></code> directory we created. Next, let’s plot the boundary shapefile data using <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> (imported as <code class="docutils literal notranslate"><span class="pre">gpd</span></code>) as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shp_path</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DPQA_2021_merged_tiles.shp&#39;</span><span class="p">))</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">();</span> <span class="n">ax</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;AOP Coverage of &#39;</span> <span class="o">+</span> <span class="n">site</span> <span class="o">+</span> <span class="s1">&#39; in &#39;</span> <span class="o">+</span> <span class="n">year</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">);</span> <span class="c1">#optionally rotate the xtick labels</span>

<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shp_path2</span><span class="p">,</span><span class="s1">&#39;2019_SOAP_4_merged_tiles.shp&#39;</span><span class="p">))</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">();</span> <span class="n">ax</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;AOP Coverage of &#39;</span> <span class="o">+</span> <span class="n">site</span> <span class="o">+</span> <span class="s1">&#39; in &#39;</span> <span class="o">+</span> <span class="n">year2</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">);</span> <span class="c1">#optionally rotate the xtick labels</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download_aop_files</span><span class="p">(</span><span class="n">dpID</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">kml_path</span><span class="p">,</span><span class="s1">&#39;full_boundary.kml&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="n">dpID</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year2</span><span class="p">,</span><span class="n">kml_path2</span><span class="p">,</span><span class="s1">&#39;full_boundary.kml&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download_aop_files</span><span class="p">(</span><span class="s1">&#39;DP1.30003.001&#39;</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">laz_path</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;293000_4100000_classified_point_cloud_colorized.laz&#39;</span><span class="p">)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="s1">&#39;DP1.30003.001&#39;</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year2</span><span class="p">,</span><span class="n">laz_path2</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;293000_4100000_classified_point_cloud_colorized.laz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">os.listdir</span></code> again to check that this file successfully downloaded to the expected location. Alternatively you could go into your file explorer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">laz_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">laz_path2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="exploring-point-cloud-data-with-laspy">
<h2>Exploring point cloud data with <code class="docutils literal notranslate"><span class="pre">laspy</span></code><a class="headerlink" href="#exploring-point-cloud-data-with-laspy" title="Permalink to this heading">#</a></h2>
<p>Now that we’ve successfully downloaded a laz (or zipped las) file, we can use the <code class="docutils literal notranslate"><span class="pre">laspy</span></code> package to read it in! We’ll do that in the next line, reading the lidar file into the variable name <code class="docutils literal notranslate"><span class="pre">point_cloud</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use os.path.join to get the full path of the laz file</span>
<span class="n">point_cloud_2021</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">laz_path</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP1_293000_4100000_classified_point_cloud_colorized.laz&#39;</span><span class="p">)</span>
<span class="c1"># read the laz file into a LasData object using laspy.read()</span>
<span class="n">las_2021</span><span class="o">=</span><span class="n">laspy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">point_cloud_2021</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use os.path.join to get the full path of the laz file</span>
<span class="n">point_cloud_2019</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">laz_path2</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP1_293000_4100000_classified_point_cloud_colorized.laz&#39;</span><span class="p">)</span>
<span class="c1"># read the laz file into a LasData object using laspy.read()</span>
<span class="n">las_2019</span><span class="o">=</span><span class="n">laspy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">point_cloud_2019</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Reading in the file with with laspy.read() reads in both the metadata and the raw point cloud data. We can print out the <code class="docutils literal notranslate"><span class="pre">point_cloud</span></code> variable to show some basic information about what we’ve read in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">las_2021</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">las_2019</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">point_format.dimension_names</span></code> show us the available information stored in this LasData object format:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">las_2021</span><span class="o">.</span><span class="n">point_format</span><span class="o">.</span><span class="n">dimension_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the next few cells, we can explore some of these variables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">las_2021</span><span class="o">.</span><span class="n">classification</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s get the <code class="docutils literal notranslate"><span class="pre">set</span></code> of this <code class="docutils literal notranslate"><span class="pre">list</span></code> to see all the unique classification values in this file. This may take a little time to run.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">las_2021</span><span class="o">.</span><span class="n">classification</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We can see that there are a several unique classification values for this site.
Las files have “predefined classification schemes defined by the American Society for Photogrammetry and Remote Sensing (ASPRS)”. You can refer to the <a href="https://desktop.arcgis.com/en/arcmap/10.3/manage-data/las-dataset/lidar-point-classification.htm" target="_blank">ArcGIS documentation</a> for more details.</p>
<p>The following table lists the LAS classification codes defined by ASPRS for these LAS versions:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Classification value</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Never classified</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Unassigned</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Low Vegetation</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Medium Vegetation</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>High Vegetation</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>Building</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>Low Point</p></td>
</tr>
</tbody>
</table>
<p>Next let’s take a look at what we can consider to be the main data - the geographic loation of each point in the point cloud. This can be accessed either by <code class="docutils literal notranslate"><span class="pre">point_cloud.xyz</span></code>. Let’s take a look:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Function to import las file as a dataframe in python</span>
<span class="k">def</span> <span class="nf">las_to_df</span><span class="p">(</span><span class="n">las</span><span class="p">):</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">las</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">las</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">las</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
  <span class="n">intensity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">las</span><span class="o">.</span><span class="n">intensity</span><span class="p">))</span>
  <span class="n">return_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">las</span><span class="o">.</span><span class="n">return_number</span><span class="p">))</span>
  <span class="n">number_of_returns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">las</span><span class="o">.</span><span class="n">number_of_returns</span><span class="p">))</span>
  <span class="n">classification</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">las</span><span class="o">.</span><span class="n">classification</span><span class="p">))</span> <span class="c1">## 0 - 31 as per ASPRS classification scheme</span>

  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">return_num</span><span class="p">,</span> <span class="n">number_of_returns</span><span class="p">,</span> <span class="n">classification</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;return_num&quot;</span><span class="p">,</span> <span class="s2">&quot;number_of_returns&quot;</span><span class="p">,</span> <span class="s2">&quot;classification&quot;</span><span class="p">]</span>
  <span class="k">return</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Call the las_to_df function to extract the 2019 and 2021 data as separate dataframes</span>
<span class="n">point_cloud_df_2019</span> <span class="o">=</span> <span class="n">las_to_df</span><span class="p">(</span><span class="n">las_2019</span><span class="p">)</span>
<span class="n">point_cloud_df_2021</span> <span class="o">=</span> <span class="n">las_to_df</span><span class="p">(</span><span class="n">las_2021</span><span class="p">)</span>
<span class="n">point_cloud_df_2021</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Use np.stack to combine the X, Y and Z into one array</span>
<span class="c1">## Convert (3 x n) array to (n x 3) using transpose</span>
<span class="n">point_data_2021</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">las_2021</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">las_2021</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">las_2021</span><span class="o">.</span><span class="n">Z</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">point_data_2019</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">las_2019</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">las_2019</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">las_2019</span><span class="o">.</span><span class="n">Z</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of discrete returns in the 2021 point cloud file = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="s2">&quot;</span><span class="si">{:,}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">point_data_2021</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of discrete returns in the 2019 point cloud file = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="s2">&quot;</span><span class="si">{:,}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">point_data_2019</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>There are &gt; 2 million lidar points in this single 1km x 1km tile. For the rest of this exercise, we’ll look at a random subset of these points, taking every100th point (you can change this subset factor, but when we visualize the data in a few steps, subsetting by a larger factor will speed up the time it takes to make the plot).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">factor</span><span class="o">=</span><span class="mi">100</span>
<span class="n">point_data_2021_sub</span> <span class="o">=</span> <span class="n">point_data_2021</span><span class="p">[::</span><span class="n">factor</span><span class="p">]</span>
<span class="n">point_data_2019_sub</span> <span class="o">=</span> <span class="n">point_data_2019</span><span class="p">[::</span><span class="n">factor</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of discrete returns in the 2021 point cloud subsample = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="s2">&quot;</span><span class="si">{:,}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">point_data_2021_sub</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of discrete returns in the 2019 point cloud subsample = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="s2">&quot;</span><span class="si">{:,}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">point_data_2019_sub</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>These point clouds have been “colorized” by the camera RGB imagery. If you refer back to the dimension names, you can see there are a <code class="docutils literal notranslate"><span class="pre">red</span></code>, <code class="docutils literal notranslate"><span class="pre">green</span></code>, and <code class="docutils literal notranslate"><span class="pre">blue</span></code> attributes. We can pull these into a single array by using <code class="docutils literal notranslate"><span class="pre">np.vstack</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors_2021</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">las_2021</span><span class="o">.</span><span class="n">red</span><span class="p">,</span> <span class="n">las_2021</span><span class="o">.</span><span class="n">green</span><span class="p">,</span> <span class="n">las_2021</span><span class="o">.</span><span class="n">blue</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">colors_2019</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">las_2019</span><span class="o">.</span><span class="n">red</span><span class="p">,</span> <span class="n">las_2019</span><span class="o">.</span><span class="n">green</span><span class="p">,</span> <span class="n">las_2019</span><span class="o">.</span><span class="n">blue</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>These colors have been scaled to store the color at a higher resolution, accomodated by the camera, so we’ll need to re-scale the values between 0-1 in order to use them in our plot. The code below does this re-scaling, and then subsets the color data to by same factor we used to subset the <code class="docutils literal notranslate"><span class="pre">xyz</span></code> data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors_2021_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">colors_2021</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">colors_2021</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">colors_2021</span><span class="p">)</span>
<span class="n">colors_2021_normalized_sub</span> <span class="o">=</span> <span class="n">colors_2021_normalized</span><span class="p">[::</span><span class="n">factor</span><span class="p">]</span>
<span class="c1">## We are going to zip the R,G,B values together for plotting using the matplotlib package</span>
<span class="n">colors_2021_normalized_sub</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">colors_2021_normalized_sub</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors_2021_normalized_sub</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors_2021_normalized_sub</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]))</span>

<span class="n">colors_2019_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">colors_2019</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">colors_2019</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">colors_2019</span><span class="p">)</span>
<span class="n">colors_2019_normalized_sub</span> <span class="o">=</span> <span class="n">colors_2019_normalized</span><span class="p">[::</span><span class="n">factor</span><span class="p">]</span>
<span class="n">colors_2019_normalized_sub</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">colors_2019_normalized_sub</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors_2019_normalized_sub</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors_2019_normalized_sub</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="d-point-cloud-visualization">
<h2>3D Point Cloud Visualization<a class="headerlink" href="#d-point-cloud-visualization" title="Permalink to this heading">#</a></h2>
<p>Lastly, we can visualize this 3D data using matplotlib to see what the point cloud looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the las data in 3D</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

<span class="c1">## Plot the 2021 data</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">point_data_2021_sub</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">point_data_2021_sub</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">point_data_2021_sub</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors_2021_normalized_sub</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">point_data_2019_sub</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">point_data_2019_sub</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">point_data_2019_sub</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors_2019_normalized_sub</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="lidar-raster-data-dtm-dsm-and-chm">
<h2>Lidar Raster Data - DTM, DSM, and CHM<a class="headerlink" href="#lidar-raster-data-dtm-dsm-and-chm" title="Permalink to this heading">#</a></h2>
<p>Lastly, we’ll take a look at some of the derived (Level-3, or L3) data products generated from this point cloud data. NEON generates 5 different derived L3 products from the discrete data, summarized below.</p>
<p>In the last part of this lesson, we’ll show how to read in and visualize the CHM, DTM, and DSM data using the Python package <code class="docutils literal notranslate"><span class="pre">rasterio</span></code>. First we’ll import the package and sub-package that’s used to display the data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
</pre></div>
</div>
</div>
</div>
<p>In the next couple cells, we’ll create a path to save the raster data, and then download the L3 CHM, DTM, and DSM geotiffs of the same tile as the point cloud file we downloaded earlier. You’ll see the syntax here is the same, we are just using different data product IDs and match_strings with the appropriate extensions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">l3_path</span> <span class="o">=</span> <span class="n">data_root_path</span><span class="o">+</span><span class="s1">&#39;L3/&#39;</span>
<span class="n">l3_path2</span> <span class="o">=</span> <span class="n">data_root_path2</span><span class="o">+</span><span class="s1">&#39;L3/&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download_aop_files</span><span class="p">(</span><span class="s1">&#39;DP3.30015.001&#39;</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">l3_path</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;293000_4100000_CHM.tif&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="s1">&#39;DP3.30024.001&#39;</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">l3_path</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;293000_4100000_DTM.tif&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="s1">&#39;DP3.30024.001&#39;</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">l3_path</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;293000_4100000_DSM.tif&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download_aop_files</span><span class="p">(</span><span class="s1">&#39;DP3.30015.001&#39;</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year2</span><span class="p">,</span><span class="n">l3_path2</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;293000_4100000_CHM.tif&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="s1">&#39;DP3.30024.001&#39;</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year2</span><span class="p">,</span><span class="n">l3_path2</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;293000_4100000_DTM.tif&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="s1">&#39;DP3.30024.001&#39;</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year2</span><span class="p">,</span><span class="n">l3_path2</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;293000_4100000_DSM.tif&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next we’ll read these in, using <code class="docutils literal notranslate"><span class="pre">rasterio</span></code>, as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chm</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l3_path</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP3_293000_4100000_CHM.tif&#39;</span><span class="p">))</span>
<span class="n">dtm</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l3_path</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP3_293000_4100000_DTM.tif&#39;</span><span class="p">))</span>
<span class="n">dsm</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l3_path</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP3_293000_4100000_DSM.tif&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chm2019</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l3_path2</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP3_293000_4100000_CHM.tif&#39;</span><span class="p">))</span>
<span class="n">dtm2019</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l3_path2</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP3_293000_4100000_DTM.tif&#39;</span><span class="p">))</span>
<span class="n">dsm2019</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l3_path2</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP3_293000_4100000_DSM.tif&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>And finally, we can plot the data using the rasterio <code class="docutils literal notranslate"><span class="pre">show</span></code> function that we imported earlier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">show</span><span class="p">((</span><span class="n">chm</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;CHM&#39;</span><span class="p">);</span>
<span class="n">show</span><span class="p">((</span><span class="n">dtm</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;DTM&#39;</span><span class="p">);</span>
<span class="n">show</span><span class="p">((</span><span class="n">dsm</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;DSM&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">show</span><span class="p">((</span><span class="n">chm2019</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;CHM&#39;</span><span class="p">);</span>
<span class="n">show</span><span class="p">((</span><span class="n">dtm2019</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;DTM&#39;</span><span class="p">);</span>
<span class="n">show</span><span class="p">((</span><span class="n">dsm2019</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;DSM&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="lidar-raster-data-group-notes">
<h1>Lidar Raster Data (group notes)<a class="headerlink" href="#lidar-raster-data-group-notes" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>DSM, DTM and CHM are derived (Level-3, or L3) data products generated from this point cloud data</p></li>
<li><p>Package - rasterio</p></li>
</ul>
<p><img src='https://drive.google.com/uc?export=view&id=10xcPfqTQVfzfNlaC6M72KoyVldwLzanu' width=800> Image credit: <a class="reference external" href="https://opentopography.org/lidar_basics">OpenTopography</a></p>
<p>DSM</p>
<ul class="simple">
<li><p>digital surface model</p></li>
<li><p>a three-dimensional representation of the upper elevations of a landscape</p></li>
<li><p>includes the bare surface and above-ground features like vegetation, buildings, and other structures.</p></li>
</ul>
<p>DTM</p>
<ul class="simple">
<li><p>digital terrain model</p></li>
<li><p>a three-dimensional representation of the bare ground surface</p></li>
<li><p>natural and built features (i.e., vegetation and buildings) are removed from the landscape to show just the topography</p></li>
</ul>
<p>CHM</p>
<ul class="simple">
<li><p>Canopy height models</p></li>
<li><p>measurement of trees, vegetation, buildings, and other structures above the bare ground surface.</p></li>
<li><p>CHM = DSM-DTM</p></li>
</ul>
<p>2019 vs 2021 analysis</p>
<ul class="simple">
<li><p>dowload data</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># dowlnoad data (example code)</span>
<span class="n">download_aop_files</span><span class="p">(</span><span class="s1">&#39;DP3.30015.001&#39;</span><span class="p">,</span><span class="n">site</span><span class="p">,</span><span class="n">year2</span><span class="p">,</span><span class="n">l3_path2</span><span class="p">,</span><span class="n">match_string</span><span class="o">=</span><span class="s1">&#39;293000_4100000_CHM.tif&#39;</span><span class="p">,</span><span class="n">check_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># read the files using rasterio (example code)</span>
<span class="n">chm</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l3_path</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP3_293000_4100000_CHM.tif&#39;</span><span class="p">))</span>
<span class="n">dtm</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l3_path</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP3_293000_4100000_DTM.tif&#39;</span><span class="p">))</span>
<span class="n">dsm</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l3_path</span><span class="p">,</span><span class="s1">&#39;NEON_D17_SOAP_DP3_293000_4100000_DSM.tif&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the data (example code)</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">show</span><span class="p">((</span><span class="n">chm</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;CHM&#39;</span><span class="p">);</span>
<span class="n">show</span><span class="p">((</span><span class="n">dtm</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;DTM&#39;</span><span class="p">);</span>
<span class="n">show</span><span class="p">((</span><span class="n">dsm</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;DSM&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">;</span>
</pre></div>
</div>
<p><img src='https://drive.google.com/uc?export=view&id=10xcov5Hk4sPvnDu2RwVTrQjm1ICZ3VlS' width=800> Image credit: [2019 vs 2021; note the darker areas in the 2021 plot]</p>
<div class="section" id="calculate-and-compare-the-relative-height-percentiles-of-the-discrete-returns-before-2019-and-after-2021-the-2020-creek-fire">
<h2>Calculate and compare the relative height percentiles of the discrete returns before (2019) and after (2021) the 2020 Creek fire.<a class="headerlink" href="#calculate-and-compare-the-relative-height-percentiles-of-the-discrete-returns-before-2019-and-after-2021-the-2020-creek-fire" title="Permalink to this heading">#</a></h2>
<p>We will now be calculating pixel-wise height percentiles (<span class="math notranslate nohighlight">\(20^{th}\)</span>, <span class="math notranslate nohighlight">\(30^{th}\)</span>, <span class="math notranslate nohighlight">\(50^{th}\)</span>, <span class="math notranslate nohighlight">\(75^{th}\)</span>, and <span class="math notranslate nohighlight">\(90^{th}\)</span> percentile heights) of the discrete returns relative to the ground (DTM) for the years 2019 and 2021. To ensure that we have sufficient number of lidar returns per pixel for calculating percentiles, we will be calculating these metrics for every 10m pixel on the ground. So, our tasks here would be to:</p>
<ol class="arabic simple">
<li><p>Calculate heights of discrete returns with repect to the 1m DTM. Since the ground heights do not change from year to year, we will be using the 2021 DTM to calculate heights of the discrete returns with respect to ground for both the years 2019 and 2021. The 2020 fire event would have likely cleared up some of the low vegetation and ground litter, thereby improving ground detection post-fire in 2021. Therefore, the 2021 DTM may be a more accurate representation of the true ground compared to the 2019 DTM.</p></li>
<li><p>Create a 10m spatial resolution raster grid and assign a unique id to each 10m pixel.</p></li>
<li><p>Group all discrete returns based on the 10m pixel they fall into.</p></li>
<li><p>Calculate height percentiles (<span class="math notranslate nohighlight">\(20^{th}\)</span>, <span class="math notranslate nohighlight">\(30^{th}\)</span>, <span class="math notranslate nohighlight">\(50^{th}\)</span>, <span class="math notranslate nohighlight">\(75^{th}\)</span>, and <span class="math notranslate nohighlight">\(90^{th}\)</span> percentile heights) relative to the ground for each 10m pixel.</p></li>
<li><p>Compare the distribution of heights for each height percentile before and after the fire.</p></li>
</ol>
</div>
<div class="section" id="discrete-return-heights-relative-to-2021-dtm">
<h2>1. Discrete-return heights relative to 2021 DTM<a class="headerlink" href="#discrete-return-heights-relative-to-2021-dtm" title="Permalink to this heading">#</a></h2>
<p>To extract the ground elevation associated with each discrete return, we will be sampling values from the 2021 DTM raster at the x,y locations of each discrete return. We can then subtract the ground elevation from the height of the discrete return (z) to get the height of the return above ground.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## zip all x and y coordinates together for sampling rasters in the next cell</span>
<span class="n">coords_2019</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">point_cloud_df_2019</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">point_cloud_df_2019</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])]</span>
<span class="n">coords_2021</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">point_cloud_df_2021</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">point_cloud_df_2021</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of discrete returns in 2021 data = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="k">len</span>(coords_2021))
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of discrete returns in 2019 data = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="k">len</span>(coords_2019))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Set a seed value to make the code output reproducible</span>
<span class="n">seed_val</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed_val</span><span class="p">)</span>

<span class="c1">## Randomly sample 1 million rows from the 2019 and 2021 point cloud dataframes</span>
<span class="n">point_cloud_df_2019_sub</span> <span class="o">=</span> <span class="n">point_cloud_df_2019</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">point_cloud_df_2021_sub</span> <span class="o">=</span> <span class="n">point_cloud_df_2021</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">## zip all x and y coordinates together for sampling rasters in the next step</span>
<span class="n">coords_2019_sub</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">point_cloud_df_2019_sub</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">point_cloud_df_2019_sub</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])]</span>
<span class="n">coords_2021_sub</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">point_cloud_df_2021_sub</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">point_cloud_df_2021_sub</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])]</span>

<span class="c1">## Sample the raster using &quot;rasterio.sample.sample_gen()&quot;</span>

<span class="c1">## Sample the 2021 DTM raster for ground elevation at each (x,y) location of the 2021 discrete returns</span>
<span class="n">dtm_vals_2021</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rasterio</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">sample_gen</span><span class="p">(</span><span class="n">dtm</span><span class="p">,</span> <span class="n">coords_2021_sub</span><span class="p">)))</span>

<span class="c1">## Sample the 2021 DTM raster for ground elevation at each (x,y) location of the 2019 discrete returns</span>
<span class="c1">## The ground elevations shouldn&#39;t change from year to year, so it is OK to use the 2021 DTM for both years.</span>
<span class="c1">## Moreover, the fire event in 2020 likely cleared the understory vegetation, and therefore, the ground elevations might be more accurate in 2021</span>
<span class="n">dtm_vals_2019</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rasterio</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">sample_gen</span><span class="p">(</span><span class="n">dtm2019</span><span class="p">,</span> <span class="n">coords_2019_sub</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Merge the point cloud dataframe (point_cloud_df_20xx_sub) with the DTM ground elevations extracted (dtm_vals_20xx)</span>
<span class="c1">## Calculate the relative height of each return with respect to ground (&quot;discrete_ret_ht_above_ground&quot;)</span>

<span class="c1">## 2019</span>
<span class="n">df_2019</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">point_cloud_df_2019_sub</span><span class="p">,</span> <span class="n">dtm_vals_2019</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_2019</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;return_num&quot;</span><span class="p">,</span> <span class="s2">&quot;number_of_returns&quot;</span><span class="p">,</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="s2">&quot;ground_elevation&quot;</span><span class="p">]</span>
<span class="n">df_2019</span><span class="p">[</span><span class="s2">&quot;discrete_ret_ht_above_ground&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_2019</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_2019</span><span class="p">[</span><span class="s2">&quot;ground_elevation&quot;</span><span class="p">]</span>

<span class="c1">## Do the same for 2021 data as well</span>
<span class="n">df_2021</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">point_cloud_df_2021_sub</span><span class="p">,</span> <span class="n">dtm_vals_2021</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_2021</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;return_num&quot;</span><span class="p">,</span> <span class="s2">&quot;number_of_returns&quot;</span><span class="p">,</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="s2">&quot;ground_elevation&quot;</span><span class="p">]</span>
<span class="n">df_2021</span><span class="p">[</span><span class="s2">&quot;discrete_ret_ht_above_ground&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_2021</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_2021</span><span class="p">[</span><span class="s2">&quot;ground_elevation&quot;</span><span class="p">]</span>
<span class="n">df_2021</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-a-10m-spatial-resolution-raster-grid-and-assign-a-unique-id-to-each-10m-pixel">
<h2>2. Create a 10m spatial resolution raster grid and assign a unique id to each 10m pixel<a class="headerlink" href="#create-a-10m-spatial-resolution-raster-grid-and-assign-a-unique-id-to-each-10m-pixel" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Create a (100 x 100) dataframe with each cell having a unique value between 0 and 10,000</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>

<span class="c1">## Create a scaled transform</span>
<span class="n">scaled_transform</span> <span class="o">=</span> <span class="n">dtm</span><span class="o">.</span><span class="n">transform</span> <span class="o">*</span> <span class="n">dtm</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">((</span><span class="mi">10</span><span class="p">),(</span><span class="mi">10</span><span class="p">))</span>

<span class="c1">## Using rasterio, save the dataframe as a 10m raster in the tif format</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
    <span class="n">data_root_path</span> <span class="o">+</span> <span class="s1">&#39;/DTM_10m_unique_id.tif&#39;</span><span class="p">,</span>
    <span class="s1">&#39;w&#39;</span><span class="p">,</span>
    <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">width</span><span class="o">=</span><span class="n">ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
    <span class="n">crs</span><span class="o">=</span><span class="n">dtm</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">scaled_transform</span><span class="p">,</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
    <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Use rioxarray again to plot the newly created 10m raster</span>
<span class="n">raster_10m</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">data_root_path</span> <span class="o">+</span> <span class="s2">&quot;DTM_10m_unique_id.tif&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">raster_10m</span><span class="p">)</span>
<span class="n">raster_10m</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Easting (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Northing (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;10m raster with unique pixel ids&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="group-all-discrete-returns-based-on-the-10m-pixel-they-fall-into">
<h2>3. Group all discrete returns based on the 10m pixel they fall into.<a class="headerlink" href="#group-all-discrete-returns-based-on-the-10m-pixel-they-fall-into" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Here, we assign unique ids created in the previous cell to each discrete return</span>
<span class="c1">## Sample the unique ids from the 10m raster for each discrete return for the years 2019 and 2021</span>
<span class="c1">## This sampling step might again take a few minutes</span>

<span class="n">raster_10m</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">data_root_path</span> <span class="o">+</span> <span class="s2">&quot;DTM_10m_unique_id.tif&quot;</span><span class="p">)</span>
<span class="c1">## For the year 2021</span>
<span class="n">dtm_id_vals_2021</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rasterio</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">sample_gen</span><span class="p">(</span><span class="n">raster_10m</span><span class="p">,</span> <span class="n">coords_2021_sub</span><span class="p">)))</span>

<span class="c1">## For the year 2019</span>
<span class="n">dtm_id_vals_2019</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rasterio</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">sample_gen</span><span class="p">(</span><span class="n">raster_10m</span><span class="p">,</span> <span class="n">coords_2019_sub</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Merge the unique ids extracted above with the discrete return dataframe (df_20xx) created earlier</span>

<span class="c1">## Update 2019 df</span>
<span class="n">df_2019_with_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_2019</span><span class="p">,</span> <span class="n">dtm_id_vals_2019</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_2019_with_ids</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;return_num&quot;</span><span class="p">,</span> <span class="s2">&quot;number_of_returns&quot;</span><span class="p">,</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;ground_elevation&quot;</span><span class="p">,</span> <span class="s2">&quot;discrete_ret_ht_above_ground&quot;</span><span class="p">,</span> <span class="s2">&quot;uniq_id&quot;</span><span class="p">]</span>
<span class="n">df_2019_with_ids</span> <span class="o">=</span> <span class="n">df_2019_with_ids</span><span class="p">[</span><span class="n">df_2019_with_ids</span><span class="p">[</span><span class="s2">&quot;ground_elevation&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">9999.0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">## Update 2021 df</span>
<span class="n">df_2021_with_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_2021</span><span class="p">,</span> <span class="n">dtm_id_vals_2021</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_2021_with_ids</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="s2">&quot;return_num&quot;</span><span class="p">,</span> <span class="s2">&quot;number_of_returns&quot;</span><span class="p">,</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;ground_elevation&quot;</span><span class="p">,</span> <span class="s2">&quot;discrete_ret_ht_above_ground&quot;</span><span class="p">,</span> <span class="s2">&quot;uniq_id&quot;</span><span class="p">]</span>
<span class="n">df_2021_with_ids</span> <span class="o">=</span> <span class="n">df_2021_with_ids</span><span class="p">[</span><span class="n">df_2021_with_ids</span><span class="p">[</span><span class="s2">&quot;ground_elevation&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">9999.0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_2021_with_ids</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">return_counts_per_10m_pixel_2019</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_2019_with_ids</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(),</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">return_counts_per_10m_pixel_2021</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_2021_with_ids</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(),</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">return_counts_per_10m_pixel_2019</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">return_counts_per_10m_pixel_2021</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;# discrete returns per 10m pixel&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of # of discrete returns per 10m pixel&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;2019&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
                  <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;2021&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="calculate-height-percentiles-of-discrete-returns-20th-30th-50th-75th-and-90th-for-each-10m-pixel">
<h2>4. Calculate height percentiles of discrete returns (20th, 30th, 50th, 75th, and 90th) for each 10m pixel.<a class="headerlink" href="#calculate-height-percentiles-of-discrete-returns-20th-30th-50th-75th-and-90th-for-each-10m-pixel" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Subset the dataframes to include only the relevant columns</span>
<span class="n">df_2019_sub</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_2019_with_ids</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">df_2019_with_ids</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">df_2019_with_ids</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">],</span> <span class="n">df_2019</span><span class="p">[</span><span class="s2">&quot;discrete_ret_ht_above_ground&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_2021_sub</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_2021_with_ids</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">df_2021_with_ids</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">df_2021_with_ids</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">],</span> <span class="n">df_2021</span><span class="p">[</span><span class="s2">&quot;discrete_ret_ht_above_ground&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">## Calculate the number of returns per 10 m pixel</span>
<span class="n">return_counts_per_10m_pixel_2019</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_2019_sub</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(),</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">return_counts_per_10m_pixel_2021</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_2021_sub</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(),</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">return_counts_per_10m_pixel_2019</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">return_counts_per_10m_pixel_2021</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">,</span> <span class="s2">&quot;number_of_returns&quot;</span><span class="p">]</span>

<span class="c1">## Select only those 10m pixels which have greater than 50 returns</span>
<span class="n">return_counts_per_10m_pixel_2019</span> <span class="o">=</span> <span class="n">return_counts_per_10m_pixel_2019</span><span class="p">[</span><span class="n">return_counts_per_10m_pixel_2019</span><span class="p">[</span><span class="s2">&quot;number_of_returns&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">return_counts_per_10m_pixel_2021</span> <span class="o">=</span> <span class="n">return_counts_per_10m_pixel_2021</span><span class="p">[</span><span class="n">return_counts_per_10m_pixel_2021</span><span class="p">[</span><span class="s2">&quot;number_of_returns&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">valid_10m_pixels_2019</span> <span class="o">=</span> <span class="n">return_counts_per_10m_pixel_2019</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">]</span>
<span class="n">valid_10m_pixels_2021</span> <span class="o">=</span> <span class="n">return_counts_per_10m_pixel_2021</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">]</span>

<span class="c1">## Update df_sub to include only valid 10m pixels (returns &gt; 50)</span>
<span class="n">df_2019_sub</span> <span class="o">=</span> <span class="n">df_2019_sub</span><span class="p">[</span><span class="n">df_2019_sub</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_10m_pixels_2019</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_2021_sub</span> <span class="o">=</span> <span class="n">df_2021_sub</span><span class="p">[</span><span class="n">df_2021_sub</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_10m_pixels_2021</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## For each unique id (uniq_id), calculate relative height percentiles (20th, 30th, 50th, 75th and 90th)</span>

<span class="c1">## First define a function to calculate the percentile and return a percentile dataframe</span>
<span class="k">def</span> <span class="nf">calc_percentile</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">percentile</span><span class="p">):</span>
    <span class="n">ptile_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;uniq_id&quot;</span><span class="p">])[</span><span class="s2">&quot;discrete_ret_ht_above_ground&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">percentile</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">ptile_df</span><span class="p">[</span><span class="s2">&quot;RH_ptile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">percentile</span><span class="o">*</span><span class="mi">100</span>
    <span class="n">ptile_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="s2">&quot;RH_ptile&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ptile_df</span>

<span class="n">ptile_20_2019</span> <span class="o">=</span> <span class="n">calc_percentile</span><span class="p">(</span><span class="n">df_2019_sub</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">ptile_30_2019</span> <span class="o">=</span> <span class="n">calc_percentile</span><span class="p">(</span><span class="n">df_2019_sub</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ptile_50_2019</span> <span class="o">=</span> <span class="n">calc_percentile</span><span class="p">(</span><span class="n">df_2019_sub</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ptile_75_2019</span> <span class="o">=</span> <span class="n">calc_percentile</span><span class="p">(</span><span class="n">df_2019_sub</span><span class="p">,</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">ptile_90_2019</span> <span class="o">=</span> <span class="n">calc_percentile</span><span class="p">(</span><span class="n">df_2019_sub</span><span class="p">,</span><span class="mf">0.9</span><span class="p">)</span>

<span class="n">ptile_20_2021</span> <span class="o">=</span> <span class="n">calc_percentile</span><span class="p">(</span><span class="n">df_2021_sub</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">ptile_30_2021</span> <span class="o">=</span> <span class="n">calc_percentile</span><span class="p">(</span><span class="n">df_2021_sub</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ptile_50_2021</span> <span class="o">=</span> <span class="n">calc_percentile</span><span class="p">(</span><span class="n">df_2021_sub</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ptile_75_2021</span> <span class="o">=</span> <span class="n">calc_percentile</span><span class="p">(</span><span class="n">df_2021_sub</span><span class="p">,</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">ptile_90_2021</span> <span class="o">=</span> <span class="n">calc_percentile</span><span class="p">(</span><span class="n">df_2021_sub</span><span class="p">,</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rh_percentiles_2019</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ptile_20_2019</span><span class="p">,</span> <span class="n">ptile_30_2019</span><span class="p">,</span> <span class="n">ptile_50_2019</span><span class="p">,</span> <span class="n">ptile_75_2019</span><span class="p">,</span> <span class="n">ptile_90_2019</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rh_percentiles_2019</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2019</span>

<span class="n">rh_percentiles_2021</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ptile_20_2021</span><span class="p">,</span> <span class="n">ptile_30_2021</span><span class="p">,</span> <span class="n">ptile_50_2021</span><span class="p">,</span> <span class="n">ptile_75_2021</span><span class="p">,</span> <span class="n">ptile_90_2021</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rh_percentiles_2021</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2021</span>

<span class="c1">## Combine 2019 and 2021 dataframes</span>
<span class="n">rh_percentiles_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">rh_percentiles_2019</span><span class="p">,</span> <span class="n">rh_percentiles_2021</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compare-the-distribution-of-height-percentiles-for-the-years-2019-and-2021">
<h2>5. Compare the distribution of height percentiles for the years 2019 and 2021.<a class="headerlink" href="#compare-the-distribution-of-height-percentiles-for-the-years-2019-and-2021" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Compare boxplots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rh_percentiles_combined</span><span class="p">[</span><span class="s2">&quot;RH_ptile&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">rh_percentiles_combined</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">rh_percentiles_combined</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
           <span class="n">fliersize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">whis</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">95</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Height percentile&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Heights (in m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Relative Height Percentiles before (2019) and after (2021) the 2020 Creek Fire&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="additional-resources">
<h2>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>L1 Point Clouds (.laz)</strong>: If you’d like to continue exploring the point cloud data in Python using <code class="docutils literal notranslate"><span class="pre">laspy</span></code>, <a href="https://laspy.readthedocs.io/en/latest/complete_tutorial.html" target="_blank"> laspy website </a> has some nice examples you can follow, now that you know how to download NEON point cloud data and read it into Python.</p></li>
<li><p><strong>L3 Rasters (.tif)</strong>: Refer to the <a href="https://rasterio.readthedocs.io/en/latest/" target="_blank"> rasterio documentation </a> for more options on plotting, and beyond in rasterio.</p></li>
</ul>
<div class="section" id="python-and-beyond-other-options-for-working-with-point-cloud-data">
<h3>Python and Beyond - Other Options for working with Point Cloud Data<a class="headerlink" href="#python-and-beyond-other-options-for-working-with-point-cloud-data" title="Permalink to this heading">#</a></h3>
<p>There are also a number of open-source tools for working with point-cloud data. Python may not be the best option for developing more rigourous processing workflows, for example. The resources below show some other recommended tools that can be integrated with Python for your analysis:</p>
<ul class="simple">
<li><p><a href="https://rapidlasso.com/lastools/" target="_blank">LAStools</a></p></li>
<li><p><a href="https://pdal.io/en/stable/" target="_blank">PDAL (Point Data Abstraction Library)</a></p></li>
<li><p><a href="https://plas.io/" target="_blank">plas.io (free, interactive, web-based point cloud visualization)</a></p></li>
<li><p><a href="https://r-lidar.github.io/lidRbook/" target="_blank"> lidR (R package for point cloud data)</a></p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./google_drive/colab_notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="final_disturbance_raster.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><strong>Mapping Fire Impacts - Raster-based</strong></p>
      </div>
    </a>
    <a class="right-next"
       href="final_landcover_zonalstats.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><strong>Zonal Stats: Exploring spectra by land cover</strong></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Mapping Fire Impacts - LiDAR-based</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reflection-exercises-for-each-group">Reflection exercises for each group:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">Import Packages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-tip">Data Tip</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lidar-metadata">Lidar Metadata</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lidar-documentation-qa-pdfs">Lidar Documentation - QA pdfs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-plot-shapefile-boundaries">Download and Plot Shapefile Boundaries</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-point-cloud-data-with-laspy">Exploring point cloud data with <code class="docutils literal notranslate"><span class="pre">laspy</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#d-point-cloud-visualization">3D Point Cloud Visualization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lidar-raster-data-dtm-dsm-and-chm">Lidar Raster Data - DTM, DSM, and CHM</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#lidar-raster-data-group-notes">Lidar Raster Data (group notes)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-and-compare-the-relative-height-percentiles-of-the-discrete-returns-before-2019-and-after-2021-the-2020-creek-fire">Calculate and compare the relative height percentiles of the discrete returns before (2019) and after (2021) the 2020 Creek fire.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discrete-return-heights-relative-to-2021-dtm">1. Discrete-return heights relative to 2021 DTM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-10m-spatial-resolution-raster-grid-and-assign-a-unique-id-to-each-10m-pixel">2. Create a 10m spatial resolution raster grid and assign a unique id to each 10m pixel</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#group-all-discrete-returns-based-on-the-10m-pixel-they-fall-into">3. Group all discrete returns based on the 10m pixel they fall into.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-height-percentiles-of-discrete-returns-20th-30th-50th-75th-and-90th-for-each-10m-pixel">4. Calculate height percentiles of discrete returns (20th, 30th, 50th, 75th, and 90th) for each 10m pixel.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-the-distribution-of-height-percentiles-for-the-years-2019-and-2021">5. Compare the distribution of height percentiles for the years 2019 and 2021.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">Additional Resources</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-and-beyond-other-options-for-working-with-point-cloud-data">Python and Beyond - Other Options for working with Point Cloud Data</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Carissa DeRanek & Jonathan Pando Ocón, PhD
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>